{% extends "base.html" %}
{% load static %}

{% block title %}Profile | SkillConnect{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-16 px-6 flex items-center justify-center relative overflow-hidden">

  <!-- Bubbles -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
  </div>

  <!-- RGB Border Wrapper -->
  <div class="relative p-[2.5px] rounded-3xl bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 animate-border-spin max-w-3xl w-full">

    <!-- Profile Card -->
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full">
      
      <!-- Header -->
      <div class="text-center mb-8">
        <h2 class="text-4xl font-extrabold text-indigo-700">My Profile</h2>
        <p class="text-gray-500 mt-2 text-base font-light">âœ¨ Manage your journey with <span class="text-indigo-600 font-semibold">SkillConnect</span></p>
      </div>

      <!-- Profile Info -->
      <div id="profileContainer" class="space-y-8 text-gray-700">

        <!-- Common -->
        <div class="grid md:grid-cols-2 gap-6 bg-gray-50 rounded-2xl p-6 shadow-inner">
          <p class="text-base"><span class="font-semibold text-indigo-600">ğŸ‘¤ Username:</span> <span id="pUsername"></span></p>
          <p class="text-base"><span class="font-semibold text-indigo-600">ğŸ“§ Email:</span> <span id="pEmail"></span></p>
          <p class="text-base"><span class="font-semibold text-indigo-600">ğŸ­ Role:</span> <span id="pRole"></span></p>
        </div>

        <!-- Freelancer Section -->
        <div id="freelancerSection" class="hidden bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-6 space-y-3 border border-indigo-100 shadow-md">
          <h3 class="text-xl font-semibold text-indigo-700 border-b pb-2">ğŸ‘¨â€ğŸ’» Freelancer Details</h3>
          <p><span class="text-indigo-600 font-semibold">ğŸ’¡ Headline:</span> <span id="pHeadline"></span></p>
          <p><span class="text-indigo-600 font-semibold">ğŸ“ Summary:</span> <span id="pSummary"></span></p>
          <p><span class="text-indigo-600 font-semibold">ğŸ“ Education:</span> <span id="pEducation"></span></p>
          <p><span class="text-indigo-600 font-semibold">â³ Experience:</span> <span id="pExperience"></span> years</p>
          <p><span class="text-indigo-600 font-semibold">âš™ï¸ Tech Stack:</span> <span id="pTech"></span></p>
          <p><span class="text-indigo-600 font-semibold">ğŸ›  Skills:</span> <span id="pSkills"></span></p>
          <p><span class="text-indigo-600 font-semibold">ğŸ‚ DOB:</span> <span id="pDob"></span></p>
          <p><span class="text-indigo-600 font-semibold">ğŸ“„ Resume:</span> 
            <a id="pResume" href="#" target="_blank" class="text-blue-600 underline hover:text-blue-800">View</a>
          </p>
        </div>

        <!-- Recruiter Section -->
        <div id="recruiterSection" class="hidden bg-gradient-to-r from-purple-50 to--50 rounded-2xl p-6 space-y-3 border border-purple-100 shadow-md">
          <h3 class="text-xl font-semibold text-purple-700 border-b pb-2">ğŸ¢ Recruiter Details</h3>
          <p><span class="text-purple-600 font-semibold">ğŸ· Company:</span> <span id="pCompany"></span></p>
          <p><span class="text-purple-600 font-semibold">ğŸ”— Website:</span> 
            <a id="pWebsite" href="#" target="_blank" class="text-blue-600 underline hover:text-blue-800"></a>
          </p>
          <p><span class="text-purple-600 font-semibold">ğŸ“– About:</span> <span id="pAbout"></span></p>
        </div>
      </div>

      <!-- Buttons -->
<div class="flex justify-between mt-10">
  <button id="editBtn"
          class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-3 rounded-xl shadow-lg hover:from-blue-600 hover:to-blue-700 transition font-medium">
    âœï¸ Edit
  </button>
  <button id="logoutBtn"
          class="bg-gradient-to-r from-red-500 to-red-600 text-white px-8 py-3 rounded-xl shadow-lg hover:from-red-600 hover:to-red-700 transition font-medium">
    ğŸšª Logout
  </button>
</div>

    </div>
  </div>
</div>

<!-- CSS for border animation + bubbles -->
<style>
  .animate-border-spin {
    background-size: 300% 300%;
    animation: borderMove 6s linear infinite;
  }
  @keyframes borderMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Bubble styles */
  .bubble {
    position: absolute;
    bottom: -150px;
    background: rgba(99, 102, 241, 0.35); /* more visible */
    border-radius: 50%;
    animation: rise linear infinite;
  }

  .bubble:nth-child(1) { left: 10%; width: 40px; height: 40px; animation-duration: 18s; }
  .bubble:nth-child(2) { left: 20%; width: 25px; height: 25px; animation-duration: 12s; animation-delay: 2s; }
  .bubble:nth-child(3) { left: 35%; width: 60px; height: 60px; animation-duration: 25s; animation-delay: 4s; }
  .bubble:nth-child(4) { left: 50%; width: 20px; height: 20px; animation-duration: 10s; animation-delay: 6s; }
  .bubble:nth-child(5) { left: 65%; width: 45px; height: 45px; animation-duration: 14s; animation-delay: 3s; }
  .bubble:nth-child(6) { left: 75%; width: 30px; height: 30px; animation-duration: 16s; animation-delay: 5s; }
  .bubble:nth-child(7) { left: 85%; width: 55px; height: 55px; animation-duration: 22s; animation-delay: 1s; }
  .bubble:nth-child(8) { left: 95%; width: 35px; height: 35px; animation-duration: 15s; animation-delay: 7s; }

  @keyframes rise {
    0% { transform: translateY(0) scale(1); opacity: 0.7; }
    50% { opacity: 0.4; }
    100% { transform: translateY(-120vh) scale(1.3); opacity: 0; }
  }
</style>

<!-- Attach JS -->
<script src="{% static 'app.js' %}"></script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("access");
    if (!token) {
      window.location.href = "/login/";
      return;
    }

    try {
      const res = await fetch("http://127.0.0.1:8000/api/me/", {
        headers: { Authorization: `Bearer ${token}` },
      });
      const data = await res.json();

      document.getElementById("pUsername").innerText = data.username;
      document.getElementById("pEmail").innerText = data.email;
      document.getElementById("pRole").innerText = data.role;

      if (data.role === "freelancer" && data.profile) {
        document.getElementById("freelancerSection").classList.remove("hidden");
        document.getElementById("pHeadline").innerText = data.profile.headline || "â€”";
        document.getElementById("pSummary").innerText = data.profile.summary || "â€”";
        document.getElementById("pEducation").innerText = data.profile.education || "â€”";
        document.getElementById("pExperience").innerText = data.profile.years_of_experience ?? "â€”";
        document.getElementById("pTech").innerText = data.profile.tech_stack || "â€”";
        document.getElementById("pSkills").innerText = data.profile.skills || "â€”";
        document.getElementById("pDob").innerText = data.profile.dob || "â€”";
        if (data.profile.resume) {
          document.getElementById("pResume").href = data.profile.resume;
        } else {
          document.getElementById("pResume").innerText = "Not uploaded";
          document.getElementById("pResume").removeAttribute("href");
        }
      }

      if (data.role === "recruiter" && data.profile) {
        document.getElementById("recruiterSection").classList.remove("hidden");
        document.getElementById("pCompany").innerText = data.profile.company_name || "â€”";
        if (data.profile.website) {
          document.getElementById("pWebsite").innerText = data.profile.website;
          document.getElementById("pWebsite").href = data.profile.website;
        } else {
          document.getElementById("pWebsite").innerText = "â€”";
          document.getElementById("pWebsite").removeAttribute("href");
        }
        document.getElementById("pAbout").innerText = data.profile.about || "â€”";
      }

      document.getElementById("editBtn").addEventListener("click", () => {
        window.location.href = `/edit_profile/?role=${data.role}`;
      });

    } catch (err) {
      console.error(err);
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("access");
    window.location.href = "/login/";
  });
</script>
{% endblock %}
